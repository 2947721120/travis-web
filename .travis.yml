---
language: node_js
node_js: "0.10.36"

addons:
  sauce_connect: true

sudo: false

cache:
  directories:
    - node_modules

before_install:
  - "npm config set spin false"
  - "npm install -g npm@^2"

install:
  - npm install -g bower
  - npm install
  - bower install

script:
  - npm test

notifications:
  campfire:
    secure: "JJezWGD9KJY/LC2aznI3Zyohy31VTIhcTKX7RWR4C/C8YKbW9kZv3xV6Vn11\nSHxJTeZo6st2Bpv6tjlWZ+HCR09kyCNavIChedla3+oHOiuL0D4gSo+gkTNW\nUKYZz9mcQUd9RoQpTeyxvdvX+l7z62/7JwFA7txHOqxbTS8jrjc="

before_deploy:
  - ASSETS_HOST=https://s3.amazonaws.com/travis-error-pages ember build --env production
  # delete some of the stuff that's useless for maintenance page
  - rm -fr dist/assets/*.js dist/images/emoji dist/index.html dist/images/sponsors
  - cp dist/maintenance.html dist/index.html

before_deploy: pushd app
after_deploy: popd
deploy:
  provider: heroku
  api_key: $HEROKU_API_KEY
  app: travis-web-staging
  on: deploy-test
  run:
    - echo $?
    - "This should not run"
  strategy: api
